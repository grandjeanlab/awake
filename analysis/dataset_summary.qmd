---
title: "summary of the datasets"
author: "Joanes Grandjean"
date: "19/6/2025"
format: gfm
jupyter: python3
execute: 
  warning: false
---

We accumulated datasets from several laboratories. Here, we carry out a descriptive summary of the dataset and its processing.

```{python}
#| eval: false
#only run this in interactive mode to turn off the autoindent in ipython
%autoindent 
```

```{python}
import pandas as pd
def get_rodent_summary(df):
  #get a summary of the total number of runs, excluded runs and number of animals
  df_summary = df.groupby("rodent.ds").size().reset_index(name='total_run')
  df_summary["total_included"] = df.groupby("rodent.ds")["exclude"].apply(lambda x: x.isna().sum()).values
  df_summary["included_percentage"] = (df_summary["total_included"] / df_summary["total_run"]) * 100
  df_summary["total_mouse"] = df.groupby("rodent.ds")["rodent.sub"].nunique().values
  #get a summary of the mice used 
  df_summary["strain"] = df.groupby("rodent.ds")["rodent.strain"].unique().values
  df_summary["male"] =  df.groupby("rodent.ds")["rodent.sex"].apply(lambda x: (x == 'm').sum()).values
  df_summary["female"] = df.groupby("rodent.ds")["rodent.sex"].apply(lambda x: (x == 'f').sum()).values
  df_summary["unknownsex"] = df.groupby("rodent.ds")["rodent.sex"].apply(lambda x: x.isna().sum()).values
  #get a summary of the animal preparation
  df_summary["headplate"] = df.groupby("rodent.ds")["head-plate"].unique().values
  df_summary["restrained"] = df.groupby("rodent.ds")["body.restrained"].unique().values
  df_summary["anesthesia"] = df.groupby("rodent.ds")["anesthesia.before.acquisition"].unique().values
  df_summary["exp.gender"] = df.groupby("rodent.ds")["main.experimenter.gender"].unique().values
  #get a summary of the MRI parameters
  df_summary["field_strength"] = df.groupby("rodent.ds")["MRI.field.strength"].unique().values
  df_summary["sequence"] = df.groupby("rodent.ds")["fMRI.sequence"].unique().values
  df_summary["TR"] = df.groupby("rodent.ds")["MRI.TR"].unique().values
  df_summary["TE"] = df.groupby("rodent.ds")["MRI.TE"].unique().values
  return df_summary


for rodent in [ "mouse", "rat" ]:
  df = pd.read_csv("../assets/tables/"+rodent+"_metadata.tsv", sep="\t")
  df["scan"] = "sub-0" + df["rodent.sub"].astype("str") + "_ses-" + df["rodent.session"].astype("str") + "_run-" + df["rodent.run"].astype("str")
  df_summary = get_rodent_summary(df)
  #saving the table for later use
  df_summary.to_csv("../assets/tables/"+rodent+"_summary.tsv", sep="\t", index=False)
  print("summary data for "+rodent)
  print(df_summary[["total_run", "total_included", "included_percentage", "total_mouse", "strain"]])

```


